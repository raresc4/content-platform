<div class="dashboard-page">
  <app-header
    [searchQuery]="searchQuery"
    [contentTabs]="contentTabs"
    [uploadOptions]="uploadOptions"
    [showUploadDropdown]="showUploadDropdown"
    (searchQueryChange)="searchQuery = $event"
    (contentTabChange)="setContentTab($event)"
    (uploadClick)="handleUpload($event)"
    (uploadDropdownToggle)="toggleUploadDropdown()"
    (userIconClick)="handleUserIconClick()"
  ></app-header>

  <main class="main-content">
    <div class="page-header">
      <div class="page-title-section">
        <h1 class="page-title">Media Library</h1>
        <p class="page-subtitle">Browse all available content</p>
      </div>
    </div>

    <div class="controls">
      <div class="filter-tabs">
        <button
          *ngFor="let tab of filterTabs"
          [class.active]="activeFilter === tab.id"
          (click)="setFilter(tab.id)"
          class="filter-tab"
        >
          {{ tab.label }}
        </button>
      </div>

      <div class="sort-dropdown">
        <svg
          class="sort-icon"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
        >
          <path
            d="M3 6h14M6 10h11M9 14h8"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
          />
        </svg>
        <select [(ngModel)]="activeSort" class="sort-select">
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>

    <div class="media-grid">
      <div
        *ngFor="let item of mediaItems"
        class="media-card"
        (click)="openMediaItem(item)"
      >
        <div class="card-thumbnail">
          <span class="badge" [ngClass]="getBadgeClass(item.type)">
            {{ getBadgeLabel(item) }}
          </span>
          <img
            [src]="item.thumbnailUrl"
            [alt]="item.title"
            class="thumbnail-image"
          />
          <div class="duration-overlay" *ngIf="item.duration">
            {{ item.duration }}
          </div>
        </div>

        <div class="card-content">
          <div class="card-header">
            <h3 class="card-title">{{ item.title }}</h3>
            <button class="menu-button">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <circle cx="10" cy="4" r="1.5" fill="currentColor" />
                <circle cx="10" cy="10" r="1.5" fill="currentColor" />
                <circle cx="10" cy="16" r="1.5" fill="currentColor" />
              </svg>
            </button>
          </div>

          <div class="card-meta">
            <span class="meta-date">{{ formatDate(item.uploadDate) }}</span>
            <span class="meta-separator">•</span>

            <span class="meta-info" *ngIf="item.dimensions">
              {{ item.dimensions.width }} × {{ item.dimensions.height }}
            </span>
            <span class="meta-info" *ngIf="item.pages">
              {{ item.pages }} pages
            </span>
            <span class="meta-info" *ngIf="item.views">
              {{ formatViews(item.views) }} views
            </span>
          </div>

          <div class="card-footer">
            <span class="file-size">{{ formatFileSize(item.size) }}</span>
            <button (click)="downloadMedia(item)" class="download-button">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path
                  d="M14 10v2.667A1.333 1.333 0 0 1 12.667 14H3.333A1.333 1.333 0 0 1 2 12.667V10M11.333 7.333L8 10.667m0 0L4.667 7.333M8 10.667V2"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
              Download
            </button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="mediaItems.length === 0" class="empty-state">
      <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
        <circle cx="32" cy="32" r="32" fill="var(--color-bg-tertiary)" />
        <path
          d="M32 20v24M20 32h24"
          stroke="var(--color-text-tertiary)"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>
      <h3>No content found</h3>
      <p>Try adjusting your search or filters</p>
    </div>
  </main>

  <!-- Image Popup -->
  <app-image-popup
    [mediaItem]="selectedMediaItem"
    [isOpen]="showImagePopup"
    (closePopup)="closeImagePopup()"
  ></app-image-popup>
</div>
